<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Read stream layer data with JS, generated by OLP SDK for Typescript.</title>
</head>

<body>
    <h1>Read stream layer data with JS, generated by OLP SDK for Typescript.</h1>
    <a href="/">Main page</a>

    <div style="margin-top: 20px;"><button onclick="subscribe()">Subscribe</button></div>
    <div id="result-subscribe"></div>

    <div style="margin-top: 20px;"><button onclick="poll()">Poll messages</button></div>
    <div id="result-poll"></div>

    <div style="margin-top: 20px;"><button onclick="seek()">Seek</button></div>
    <div id="result-seek"></div>

    <script src="https://unpkg.com/@here/olp-sdk-authentication/bundle.umd.min.js"></script>
    <script src="https://unpkg.com/@here/olp-sdk-dataservice-api/bundle.umd.min.js"></script>
    <script src="https://unpkg.com/@here/olp-sdk-dataservice-read/bundle.umd.min.js"></script>
    <script src="config.js"></script>
    <script>
        const userAuth = new UserAuth({
            env: "here",
            credentials: {
                accessKeyId: ExampleAppConfig.accessKeyId,
                accessKeySecret: ExampleAppConfig.accessKeySecret
            },
            tokenRequester: requestToken
        });

        const settings = new OlpClientSettings({
            environment: "here",
            getToken: () => userAuth.getToken()
        });

        const layerClient = new StreamLayerClient({
            catalogHrn: HRN.fromString(ExampleAppConfig.catalogHrn),
            layerId: ExampleAppConfig.streamLayerId,
            settings
        });

        let subscriptionId;

        function subscribe() {
            const request = new SubscribeRequest().withMode("serial");
            layerClient.subscribe(request).then(result => {
                subscriptionId = result;
                const node = document.createElement("p");
                const textnode = document.createTextNode(JSON.stringify(result));
                node.appendChild(textnode);
                document.getElementById("result-subscribe").appendChild(node);
            })

        }

        function poll() {
            const request = new PollRequest().withMode("serial").withSubscriptionId(subscriptionId);
            layerClient.poll(request).then(messages => {
                const node = document.createElement("p");
                const textnode = document.createTextNode(JSON.stringify(messages));
                node.appendChild(textnode);
                document.getElementById("result-poll").appendChild(node);
            })

        }

        function seek() {
            const request = new SeekRequest().withSeekOffsets({
                offsets: [{partition: 1234, offset: 1234}]
            });
            layerClient.getPartitions(request).then(result => {
                const node = document.createElement("p");
                const textnode = document.createTextNode(JSON.stringify(result));
                node.appendChild(textnode);
                document.getElementById("result-seek").appendChild(node);
            })

        }

    </script>
</body>

</html>