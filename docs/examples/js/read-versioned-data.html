<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Read versioned layer data with JS, generated by OLP SDK for Typescript.</title>
</head>

<body>
    <h1>Read versioned layer data with JS, generated by OLP SDK for Typescript.</h1>
    <a href="/">Main page</a>

    <div style="margin-top: 20px;"><button onclick="fetchPartitionsByQuadKey()">Fetch partitions metadata by
            QuadKey</button></div>
    <div id="result-fetchPartitionsByQuadKey"></div>

    <div style="margin-top: 20px;"><button onclick="fetchPartitionsByIds()">Fetch partitions metadata by
            IDs</button></div>
    <div id="result-fetchPartitionsByIds"></div>

    <div style="margin-top: 20px;"><button onclick="fetchPartitionsByIdsForVersion()">Fetch partitions metadata by
            IDs for specific version</button></div>
    <div id="result-fetchPartitionsByIdsForVersion"></div>

    <div style="margin-top: 20px;"><button onclick="fetchData()">Fetch data by datahandle</button></div>
    <div id="result-fetchData"></div>

    <script src="https://unpkg.com/@here/olp-sdk-authentication/bundle.umd.min.js"></script>
    <script src="https://unpkg.com/@here/olp-sdk-dataservice-api/bundle.umd.min.js"></script>
    <script src="https://unpkg.com/@here/olp-sdk-dataservice-read/bundle.umd.min.js"></script>
    <script>
        const userAuth = new UserAuth({
            env: "here",
            credentials: {
                accessKeyId: "your-app-id",
                accessKeySecret: "your-app-secret"
            },
            tokenRequester: requestToken
        });

        const settings = new OlpClientSettings({
            environment: "here",
            getToken: () => userAuth.getToken()
        });

        const layerClient = new VersionedLayerClient({
            catalogHrn: HRN.fromString("your-hrn"),
            layerId: "your-layer-id",
            settings
        });

        function fetchPartitionsByQuadKey() {
            const request = new QuadKeyPartitionsRequest().withQuadKey(quadKeyFromMortonCode(100000));
            layerClient.getPartitions(request).then(partitions => {
                const node = document.createElement("p");
                const textnode = document.createTextNode(JSON.stringify(partitions));
                node.appendChild(textnode);
                document.getElementById("result-fetchPartitionsByQuadKey").appendChild(node);
            })

        }

        function fetchPartitionsByIds() {
            const request = new PartitionsRequest().withPartitionIds(["100000", "100001"]);
            layerClient.getPartitions(request).then(partitions => {
                const node = document.createElement("p");
                const textnode = document.createTextNode(JSON.stringify(partitions));
                node.appendChild(textnode);
                document.getElementById("result-fetchPartitionsByIds").appendChild(node);
            })

        }

        function fetchPartitionsByIdsForVersion() {
            const layerSomeVersionClient = new VersionedLayerClient({
                catalogHrn: HRN.fromString("your-hrn"),
                layerId: "your-layer-id",
                settings,
                version: 280
            });

            const request = new PartitionsRequest().withPartitionIds(["100000", "100001"]);
            layerSomeVersionClient.getPartitions(request).then(partitions => {
                const node = document.createElement("p");
                const textnode = document.createTextNode(JSON.stringify(partitions));
                node.appendChild(textnode);
                document.getElementById("result-fetchPartitionsByIdsForVersion").appendChild(node);
            })

        }

        function fetchData() {
            const request = new DataRequest().withDataHandle("D1778424BD350C53BA424D69CF715EDD.17");
            layerClient.getData(request).then(data => data.blob()).then(blob => {
                const node = document.createElement("p");
                const textnode = document.createTextNode("Fetched data: " + "size: " + blob.size + ", type: " + blob.type);
                node.appendChild(textnode);
                document.getElementById("result-fetchData").appendChild(node);
            });
        }

    </script>
</body>

</html>