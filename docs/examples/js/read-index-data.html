<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Read index layer data with JS, generated by OLP SDK for Typescript.</title>
</head>

<body>
    <h1>Read index layer data with JS, generated by OLP SDK for Typescript.</h1>
    <a href="/">Main page</a>

    <div style="margin-top: 20px;"><button onclick="fetchPartitionsByQuery()">Fetch partitions metadata by
            Query</button></div>
    <div id="result-fetchPartitionsByQuery"></div>

    <div style="margin-top: 20px;"><button onclick="fetchData()">Fetch data by datahandle</button></div>
    <div id="result-fetchData"></div>

    <script src="https://unpkg.com/@here/olp-sdk-authentication/bundle.umd.min.js"></script>
    <script src="https://unpkg.com/@here/olp-sdk-dataservice-api/bundle.umd.min.js"></script>
    <script src="https://unpkg.com/@here/olp-sdk-dataservice-read/bundle.umd.min.js"></script>
    <script src="config.js"></script>
    <script>
        const userAuth = new UserAuth({
            env: "here",
            credentials: {
                accessKeyId: ExampleAppConfig.accessKeyId,
                accessKeySecret: ExampleAppConfig.accessKeySecret
            },
            tokenRequester: requestToken
        });

        const settings = new OlpClientSettings({
            environment: "here",
            getToken: () => userAuth.getToken()
        });

        const layerClient = new IndexLayerClient({
            catalogHrn: HRN.fromString(ExampleAppConfig.catalogHrn),
            layerId: ExampleAppConfig.indexLayerId,
            settings
        });

        function fetchPartitionsByQuery() {
            const request = new IndexQueryRequest().withQueryString("hour_from>=0");
            layerClient.getPartitions(request).then(partitions => {
                const node = document.createElement("p");
                const textnode = document.createTextNode(JSON.stringify(partitions));
                node.appendChild(textnode);
                document.getElementById("result-fetchPartitionsByQuery").appendChild(node);
            })

        }

        function fetchData() {
            layerClient.getData({
                id: "your-id"
            }).then(data => data.blob()).then(blob => {
                const node = document.createElement("p");
                const textnode = document.createTextNode("Fetched data: " + "size: " + blob.size + ", type: " + blob.type);
                node.appendChild(textnode);
                document.getElementById("result-fetchData").appendChild(node);
            });
        }

    </script>
</body>

</html>