<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Read volatile layer data with JS, generated by OLP SDK for Typescript.</title>
</head>

<body>
    <h1>Read volatile layer data with JS, generated by OLP SDK for Typescript.</h1>
    <a href="/">Main page</a>

    <div style="margin-top: 20px;"><button onclick="fetchPartitionsByQuadKey()">Fetch partitions metadata by
            QuadKey</button></div>
    <div id="result-fetchPartitionsByQuadKey"></div>

    <div style="margin-top: 20px;"><button onclick="fetchPartitionsByIds()">Fetch partitions metadata by
            IDs</button></div>
    <div id="result-fetchPartitionsByIds"></div>

    <div style="margin-top: 20px;"><button onclick="fetchData()">Fetch data by datahandle</button></div>
    <div id="result-fetchData"></div>

    <script src="https://unpkg.com/@here/olp-sdk-authentication/bundle.umd.min.js"></script>
    <script src="https://unpkg.com/@here/olp-sdk-dataservice-api/bundle.umd.min.js"></script>
    <script src="https://unpkg.com/@here/olp-sdk-dataservice-read/bundle.umd.min.js"></script>
    <script>
        const userAuth = new UserAuth({
            env: "here",
            credentials: {
                accessKeyId: "6-Z_4D2Egm-xxWjAOA6UPQ",
                accessKeySecret: "cd8mk0uGZhhRjSi1J6D8qRt3sI5VjF0hXxyNLFEO5uiCYiKtWlnW0IGIECRsRK-YRSBSuyvZp-AB8fZwz_wrXg"
            },
            tokenRequester: requestToken
        });

        const settings = new OlpClientSettings({
            environment: "here",
            getToken: () => userAuth.getToken()
        });

        const layerClient = new VolatileLayerClient({
            catalogHrn: HRN.fromString("hrn:here:data::olp-here:weather-forecast"),
            layerId: "weather-event-forecast",
            settings
        });

        function fetchPartitionsByQuadKey() {
            const request = new QuadKeyPartitionsRequest().withQuadKey(quadKeyFromMortonCode(100000));
            layerClient.getPartitions(request).then(partitions => {
                const node = document.createElement("p");
                const textnode = document.createTextNode(JSON.stringify(partitions));
                node.appendChild(textnode);
                document.getElementById("result-fetchPartitionsByQuadKey").appendChild(node);
            })

        }

        function fetchPartitionsByIds() {
            const request = new PartitionsRequest().withPartitionIds(["377893737", "377893841"]);
            layerClient.getPartitions(request).then(partitions => {
                const node = document.createElement("p");
                const textnode = document.createTextNode(JSON.stringify(partitions));
                node.appendChild(textnode);
                document.getElementById("result-fetchPartitionsByIds").appendChild(node);
            })

        }

        function fetchData() {
            const request = new DataRequest().withDataHandle("377893841");
            layerClient.getData(request).then(data => data.blob()).then(blob => {
                const node = document.createElement("p");
                const textnode = document.createTextNode("Fetched data: " + "size: " + blob.size + ", type: " + blob.type);
                node.appendChild(textnode);
                document.getElementById("result-fetchData").appendChild(node);
            }).catch(err => {
                const node = document.createElement("p");
                const textnode = document.createTextNode("Error: " + err);
                node.appendChild(textnode);
                document.getElementById("result-fetchData").appendChild(node);
            });
        }

    </script>
</body>

</html>